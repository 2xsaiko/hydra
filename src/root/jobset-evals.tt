[% WRAPPER layout.tt title="Jobset ‘$project.name:$jobset.name’ Evaluations" %]
[% PROCESS common.tt %]

<h1>Evaluations of Jobset <tt>[% INCLUDE renderLink
  uri = c.uri_for(c.controller('Project').action_for('view'), [project.name])
  title = project.name %]:[% jobset.name %]</tt></h1>

[% nrShown = evals.size > resultsPerPage ? resultsPerPage : evals.size %]
  
<p>Showing evaluations [% (page - 1) * resultsPerPage + 1 %] - [%
(page - 1) * resultsPerPage + nrShown %] out of [% total %].</p>

[% INCLUDE renderPager %]

<table class="tablesorter table table-condensed table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>Date</th>
      <th colspan='2'>Success</th>
    </tr>
  </thead>
  <tbody>
    [% last = nrShown - 1; FOREACH n IN [0..last]; eval = evals.$n; m = n + 1; next = evals.$m; %]
     <tr>
       <td><a href="[% c.uri_for(c.controller('JobsetEval').action_for('view'), [eval.id]) %]">[% eval.id %]</a>&nbsp;</td>
       <td>[% INCLUDE renderDateTime timestamp = eval.timestamp %]&nbsp;</td>
       <td align='right'>
         <span class="label label-success">[% eval.get_column('nrSucceeded') %]</span>
         <span class="label label-important">[% eval.get_column('nrBuilds') - eval.get_column('nrSucceeded') - eval.get_column('nrScheduled') %]</span>
	 [% IF eval.get_column('nrScheduled') > 0 %]
	 <span class="label">[% eval.get_column('nrScheduled') %]</span>
	 [% END %]
       </td>
       <td align='right'>
	 [% diff = eval.get_column('nrSucceeded') - next.get_column('nrSucceeded');
	    IF diff > 0 %]
	    <span class='label label-success'><strong>+[% diff %]</strong></span>
	 [% ELSIF diff < 0 && eval.get_column('nrScheduled') == 0 %]
	    <span class='label label-important'><strong>[% diff %]</strong></span>
	 [% END %]
       </td>
     </tr>
    [% END %]
  </tbody>
</table>

[% INCLUDE renderPager %]

[% END %]
